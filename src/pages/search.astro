---
import { useState } from 'react';
import BaseLayout from '../layouts/BaseLayout.astro';
---

<BaseLayout>
  <h1>Search Blogs</h1>

  <input
    type="text"
    id="searchInput"
    placeholder="Enter keyword..."
    style="padding: 0.5em; width: 300px;"
  />
  <button id="searchBtn" style="margin-left: 0.5em; padding: 0.5em;">Search</button>

  <ul id="results" style="margin-top: 1em;"></ul>

  <script type="module">
    const input = document.getElementById('searchInput');
    const btn = document.getElementById('searchBtn');
    const results = document.getElementById('results');

    async function search() {
      const query = input.value.trim();
      if (!query) {
        results.innerHTML = '<li>Please enter a keyword.</li>';
        return;
      }

      const res = await fetch(`/api/search?q=${encodeURIComponent(query)}`);
      const data = await res.json();

      if (!data.ok) {
        results.innerHTML = '<li>Error: ' + data.error + '</li>';
        return;
      }

      if (data.data.length === 0) {
        results.innerHTML = '<li>No results found.</li>';
        return;
      }

      results.innerHTML = data.data
        .map(
          (post) =>
            `<li><a href="${post.url}">${post.title}</a></li>`
        )
        .join('');
    }

    btn.addEventListener('click', search);
    input.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') search();
    });
  </script>
</BaseLayout>
