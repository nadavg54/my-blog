---
import BaseLayout from '../layouts/BaseLayout.astro';
---

<BaseLayout>
  <h1>Search Blogs</h1>

  <form id="search-form">
    <input type="text" name="title" placeholder="Search by title" />
    <input type="text" name="text" placeholder="Search by text" />
    <input type="text" name="url" placeholder="Filter by URL" />
    <button type="submit">Search</button>
  </form>

  <ul id="results"></ul>

  <script type="module">
    const form = document.getElementById('search-form');
    const resultsList = document.getElementById('results');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const formData = new FormData(form);
      const title = formData.get('title') || '';
      const text = formData.get('text') || '';
      const url = formData.get('url') || '';

      const params = new URLSearchParams();
      if (title) params.append('title', title);
      if (text) params.append('text', text);
      if (url) params.append('url', url);

      const res = await fetch(`/api/search?${params.toString()}`);
      const data = await res.json();

      resultsList.innerHTML = '';

      if (data.ok) {
        data.results.forEach(item => {
          const li = document.createElement('li');
          li.innerHTML = `<a href="${item.url}" target="_blank">${item.title}</a>`;
          resultsList.appendChild(li);
        });
      } else {
        resultsList.innerHTML = `<li>Error: ${data.error}</li>`;
      }
    });
  </script>
</BaseLayout>
